

@{
	ViewBag.Title = "Reports";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

@section stylesheets {
	@Styles.Render("~/Content/transition.css")
	@Styles.Render("~/Content/jquery-ui.min.css")

	<style>

		hr {
			border-top: 1px solid #ddd;
		}

		.transition-page {
			position: relative;
		}

		

		.btn-group-primary .dropdown-menu {
			background-color: #214680 !important;
		}

			.btn-group-primary .dropdown-menu li > a {
				color: #fff;
				font-size: 12px;
			}

				.btn-group-primary .dropdown-menu li > a:hover,
				.btn-group-primary .dropdown-menu li > a:focus {
					background-color: #214680 !important;
					color: #ffffff;
					text-decoration: underline;
				}

	
		.alert-danger-iep {			
			padding: 3px 4px;
			color: #b94a48;			
		}

		
	</style>
}

@using (Html.BeginForm("DownloadSpedPro", "Home", FormMethod.Post, htmlAttributes: new { @class = "form-inline" }))
{
	<div class="transition-page">
		<div class="col-md-2 pull-right">
			<a class="glyphicon glyphicon-arrow-left btn btn-info pull-right" data-ajax="false" data-ftrans="slide reverse " href="/Home/Reports" id="backtoportal" role="button" style="margin-top: 25px; margin-bottom:10px;font-size:20px;font-weight:bold;" title="Cancel action and go back to reports list"> </a>
		</div>
		<h2>SPED Pro Export</h2>
		<div class="container" style="overflow:hidden; margin: 0 auto 75px;">
			<div class="row">
				<div class="col-md-12">
					<div class="col-md-2">
						<label for="fiscalYear">Fiscal Year</label>
						<div class="form-group">
							<select class="form-control" id="fiscalYear" name="fiscalYear" onchange="_getStudents();"  style="border-color: #ccc; display: inline-block;" required>
								<option value="2018">2017 - 2018</option>
								<option value="2019">2018 - 2019</option>
								<option value="2020">2019 - 2020</option>
								<option value="2021">2020 - 2021</option>
								<option value="2022">2021 - 2022</option>
							</select>
						</div>
					</div>
						
				</div>
			</div>
			@if (ViewBag.canReset != null && ViewBag.canReset)
			{
				<div class="row">
					<div class="col-md-12 voffset2">					
						<div class="col-md-6">	
								<input type="checkbox" id="cbReset" name="cbReset" runat="server" onclick="_getStudents();"/> Reset Previously Submitted IEPs
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12 col-md-offset-1 voffset2">					
						<div class="col-md-6" id="divStudents">	
								
						</div>
					</div>
				</div>
			}
			<div class="row">
				<div class="col-md-12">
					<div class="col-md-2 voffset4">						
						<button type="button" id="exportButton" class="btn btn-default btn-lg "><i class="fa fa-file-export"></i> Submit</button>                                    
					</div>
				</div>
			</div>
			<div class="row voffset4">
				<div class="col-md-12">
				@if (ViewBag.errors != null)
				{
					<ul class="errorList">

						@foreach (var error in ViewBag.errors)
						{
							<li class="alert-danger-iep">@error.UserID @error.Description</li>
						}

					</ul>
				}

				@if (ViewBag.message != null)
				{
					<span style="color:green">@ViewBag.message</span>					
				}

				</div>
			</div>
		</div>

	</div>
}


@section scripts {

<script>
	$(document).ready(function () {

		$("#exportButton").click(function () {
			$("ul.errorList").empty();		
			$( ".form-inline" ).submit();
		});

        $(this).find('.dtField').each(function () {           
            $(this).removeAttr('id').removeClass('hasDatepicker'); // added the removeClass part.
            $('.dtField').datepicker({
                dateFormat: "mm/dd/yy",
                changeYear: true,
                changeMonth: true
            });
		});
	});


	function _getStudents() {
		var isChecked = $('#cbReset').is(':checked'); 
		var fiscalYear = $('#fiscalYear').val();
		if (isChecked) {
			$.ajax({
				type: 'POST',
				url: '/Home/GetSpedProStudentList',
				data: { fiscalYear: fiscalYear },
				dataType: "json",
				success: function (data) {
					if (data.result && data.students != undefined) {
						$("#divStudents").html("");
						var students = data.students;

						if (students.length == 0) {
							$("#divStudents").html("No IEPs found to reset.");
							return false;
						}

						if (students != null && students != undefined) {
							var i;

							for (i = 0; i < students.length; i++) {
								var student = students[i];

								$("#divStudents").append('<input class="form-control" type="checkbox" name="studentReset" value="' + student.UserID + '" />&nbsp;' + student.LastName + ", " + student.FirstName + "<br/>");
							}
						}
					}
				},
				error: function (data) {
					console.log("Error getting baseline goal text.");
				}
			});
		}
		else {
			$("#divStudents").html("");
		}

	}
</script>

}